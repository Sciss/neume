(function(e,n){'object'==typeof exports&&'undefined'!=typeof module?n(exports):'function'==typeof define&&define.amd?define(['exports'],n):n(e.neume={})})(this,function(e){'use strict';function n(e){const n='function'==typeof e?e:()=>e;if(0!==n.length)throw new TypeError(`
      ref required no arguments function.
    `.trim());return Object.defineProperties(n,{$$typeof:{value:'sc.ref',enumerable:!1,writable:!0,configurable:!0},valueOf:{value:n,enumerable:!1,writable:!0,configurable:!0}}),n}function t(e){return'number'==typeof e&&!Number.isNaN(e)}function r(e){return!!(e&&'sc.node'===e.$$typeof)}function a(e){return!!(e&&'sc.ref'===e.$$typeof)}function s(e){if(e){if('function'==typeof e.toSCNodeInput)return e.toSCNodeInput();if('function'==typeof e.valueOf)return e.valueOf()}return e}function d(e,t,r=[]){if(/\w~$/.test(e)&&(e+=Jn(Math.random()*et)),r.some(a))return n(()=>d(e,t,r.map(s)));if(r=r.map(s),r.some(i))throw new TypeError(`
      node[${e}] required number or sc.node, but got ${JSON.stringify(r)}.
    `.trim());const o=Object.assign(Object.create({}),{type:e,rate:t,props:r});return Object.defineProperties(o,{$$typeof:{value:'sc.node',enumerable:!1,writable:!0,configurable:!0}}),o}function i(e){return!(t(e)||r(e))}function o(e){return+e||0}function u(e,n){return l('#',e,'control',n)}function l(e,n,t,a){if(!/^[a-z]\w*$/.test(n))throw new TypeError(`
      Invalid parameter name: '${n}'
    `.trim());const r=`${e}${n}`,s='#'===e?o:c;return Array.isArray(a)?a.map((e,n,a)=>{return d(r,t,[s(e),n,a.length])}):d(r,t,[s(a),0,1])}function c(e){return+!!e}function m(e){return null==e||'object'!=typeof e&&'function'!=typeof e}function p(e){return function(...n){return'undefined'!=typeof this&&(m(this)||Array.isArray(this)||r(this)||a(this))?e(...[this].concat(n)):e(...n)}}function f(e,n){return Array.isArray(e)?e[n%e.length]:e}function g(e,n){const t=e.reduce((e,n)=>{return Array.isArray(n)?Qn(e,n.length):e},0);return 0===t?n(...e):Array.from({length:t},(t,a)=>{return g(e.map((e)=>f(e,a)),n)})}function _(e){return e.sort(h)}function h(e,n){return e=e&&e.rate||'scalar',n=n&&n.rate||'scalar',e>n}function y(...e){const{number:n,items:t}=v(e,{number:0,items:[]});return 0===t.length?n:(0!==n&&t.push(n),b(_(t)))}function v(e,n){return e.forEach((e)=>{'+'===e.type||'Sum3'===e.type||'Sum4'===e.type?v(e.props,n):'MulAdd'===e.type?v([d('*',e.rate,e.props.slice(0,2)),e.props[2]],n):'number'==typeof e?n.number+=e:n.items.push(e)}),n}function b(e){switch(e.length){case 1:return e[0];case 2:{const[n,t]=e;return'*'===n.type?d('MulAdd',n.rate,[n.props[0],n.props[1],t]):d('+',e[0].rate,e)}case 3:return d('Sum3',e[0].rate,e);case 4:return d('Sum4',e[0].rate,e);}const n=Zn(e.length/4);return b(Array.from({length:n},(n,t)=>{return b(e.slice(4*t,4*t+4))}))}function x(e,i,o,u){i=i.slice(0,o.length);const l=i.reduce((e,n)=>{return Array.isArray(n)?Qn(e,n.length):e},0);if(0!==l)return Array.from({length:l},(n,t)=>{return x(e,i.map((e)=>f(e,t)),o,u)});if(i.some(a))return n(()=>x(e,i.map(s),o,u));if(!u){if(i.some(r))return d(e,_(i.slice())[0].rate,i);if(!i.every(t))throw new TypeError(`
        op[${e}] required ${o.length} numbers, but got NaN.
      `.trim())}return o(...i)}function I(e,n){return p(function(t){return null==t?null:m(t)?n(t):x(e,[t],n)})}function R(e,n){return null==e||null==n?null:m(e)&&m(n)?e+n:x('+',[e,n],(e,n)=>{return y(e,n)},!0)}function O(e,n){return p(function(t,a){return null==t||null==a?null:m(t)&&m(a)?n(t,a):x(e,[t,a],n)})}function A(e,n){return t(e*n)?e*n:([e,n]=_([e,n]),0===n?0:1===n?e:r(e)&&'*'===e.type&&t(e.props[1]*n)?d('*',e.rate,[e.props[0],e.props[1]*n]):d('*',e.rate,[e,n]))}function T(e,n,t){return null==e||null==n||null==t?null:x('madd',[e,n,t],(e,n,t)=>{return y(A(e,n),t)},!0)}function N(e,n){return null==e||null==n?null:m(e)&&m(n)?e*n:x('*',[e,n],(e,n)=>{return A(e,n)},!0)}function k(e){return!!(e&&Object.getPrototypeOf(e)===Object.prototype)}function E(e,n){function t(e){const n=r.slice(),t=k(e[e.length-1])?e.pop():{};return e.slice(0,r.length).forEach((e,t)=>{n[t]=e}),Object.keys(t).forEach((e)=>{a.hasOwnProperty(e)&&(n[a[e]]=t[e])}),n}const a={},r=[];e.forEach(([e,n],t)=>{a[e]=t,r[t]=n});const s=(...e)=>n(...t(e));return Object.defineProperty(s,'length',{value:r.length,enumerable:!1,writable:!0,configurable:!0}),s}function C(e,n,t=[],a=d){return g(t,(...t)=>a(e,n,t))}function S(e,n){return e=L(e,n),1===e.length?e[0]:e}function L(e,n){return Array.isArray(e)?Array.isArray(n)?g([e,n],S):e.map((e)=>S(e,n)):Array.isArray(n)?n.map((n)=>S(e,n)):Array.from({length:n},(t,a)=>{return d('OutputProxy',e.rate,[e,a,n])})}function F(e,n,t){function a(n){return(...a)=>{let r,d,i,o;return t.composeArgs&&(a=t.composeArgs(a)),t.madd&&([d,i]=t.action?a.splice(-3,2):a.splice(-2,2)),t.multiOut&&('function'==typeof t.multiOut?o=t.multiOut(a):o=t.multiOut),'function'==typeof n&&(n=n(a)),r=C(e,n,a,s),t.multiOut&&(r=S(r,o)),t.madd&&(r=T(r,d,i)),r}}const r=n.slice(),s=t.createNode||d;t.madd&&r.push(['mul',1],['add',0]),t.action&&r.push(['action',0]);const i=E(r,a(t.defaultRate));return Object.keys(t.rates).forEach((e)=>{i[e]=E(r,a(t.rates[e]))}),i}function w(e){return function(n,t,a){if(null===t&&(t=a[e].rate),'audio'===t&&'audio'!==a[e].rate)throw new TypeError(`
        ${n} inputs[${e}] is not audio rate: ${a[e]}
      `.trim());return d(n,t,a)}}function P(e,n){const t=[['in',0],...n];return F(e,t,{rates:{ar:'audio',kr:'control'},defaultRate:(e)=>e[0].rate,madd:!0,createNode:w(0)})}function B(e){return F(e,Yt,{rates:{kr:'control',ir:'scalar'},defaultRate:'control'})}function D(e){return Array.isArray(e)?e:[e]}function M(e,t,a,r,s){if(e.length!==t.length+1)throw new TypeError('env error!!');return n(q(e,t,a,r,s))}function q(e,n,t,a,r){const d=n.length,o=[];o.push(s(e[0])),o.push(d),o.push(s(G(a,-99))),o.push(s(G(r,-99)));for(let u=0;u<d;u++)o.push(s(e[u+1])),o.push(s(n[u])),o.push(U(f(t,u))),o.push($(f(t,u)));return o}function U(e){return pa.hasOwnProperty(e)?pa[e]:5}function $(e){return'string'==typeof e?0:s(e)}function G(e,n){return null==e?n:e}function z(e){const n=e[1];if(e.length!==4*n+4)return!1;if(e.some(H))return!1;if(-99!==e[2]&&n<=e[2])return!1;if(-99!==e[3]&&n<=e[3])return!1;for(let t=0;t<n;t++){const n=e[4*t+6];if(!(0<=n&&9>n))return!1}return!0}function H(e){return!(t(e)||r(e))}function K(e){const n=d(0,'scalar',D(e));return Object.defineProperties(n,{valueOf:{value:()=>0,enumerable:!1,writable:!0,configurable:!0}}),n}function j(e){return(n,t)=>{return K(V(g([n].concat(t),(n,...t)=>{if('audio'===e&&!t.every(W))throw new TypeError(`node[Out] required audio inputs.`);return d('Out',e,[n].concat(t))})))}}function V(e){return Array.isArray(e)?e.reduce((e,n)=>{return e.concat(V(n))},[]):[e]}function W(e){return 0===e||'audio'===e.rate}function X(...e){switch(e.length){case 1:if(null===e[0]||Number.isFinite(e[0]))return e[0];if('string'==typeof e[0]){if(e[0].includes('(')){const[n,t]=e[0].split('(');return Z(Y(n),t.slice(0,-1))}return /[a-g]/i.test(e[0].charAt(0))?Y(e[0]):Z(0,e[0],0)}break;case 2:return'string'==typeof e[1]?Z(X(e[0]),e[1],0):Q(X(e[0]),0|e[1]);case 3:return'number'==typeof e[1]&&Array.isArray(e[2])?X(e[0]):Q(Z(X(e[0]),e[1]),e[2]);}throw new TypeError(`
    failed to parse note notation
  `.trim())}function Y(e){let n;return n=[9,11,0,2,4,5,7][e.toLowerCase().charCodeAt(0)-97],1!==e.length&&(n+=0|{"-":-1,"+":1,b:-1,"#":1}[e.charAt(1)],n+=12*(0|e.charAt(e.length-1))+12),n}function Z(e,n){const t=or[n];if(Array.isArray(t))return t.map((n)=>n+e);throw new TypeError(`
    failed to parse note notation
  `.trim())}function Q(e,n){if(0===n)return e;if(0<n)for(;n--;)e.push(e.shift()+12);else for(;n++;)e.unshift(e.pop()-12);return e}function J(e,n,t=-1,a=0){'string'==typeof e&&(e=X(e));const r=ee(n,e.length);return-1===t&&(t=r.length),Array.from({length:t},(n,t)=>{const s=Jn(t%r.length),d=Jn(t/r.length);return e[r[s]]+d*a})}function ee(e,n){switch(e.toLowerCase()){case'up':return Array.from({length:n},(e,n)=>n);case'down':return Array.from({length:n},(e,t)=>n-t-1);case'updown':return ee('up',n).concat(ee('down',n).slice(1,-1));case'downup':return ee('down',n).concat(ee('up',n).slice(1,-1));case'up&down':return ee('up',n).concat(ee('down',n));case'down&up':return ee('down',n).concat(ee('up',n));case'converge':return Array.from({length:n},(e,t)=>{return t%2?n-Jn(t/2)-1:t/2});case'diverge':return ee('converge',n).reverse();case'con&diverge':return ee('converge',n).concat(ee('diverge',n).slice(1,-1));case'pinky up':return Array.from({length:2*n-2},(e,t)=>{return t%2?n-1:t/2});case'pinky updown':return ee('pinky up',n).concat(ee('pinky up',n).reverse().slice(3,-1));case'thumb up':return Array.from({length:2*n-2},(e,n)=>{return n%2?Zn(n/2):0});case'thumb updown':return ee('thumb up',n).concat(ee('thumb up',n).reverse().slice(1,-3));}throw new TypeError(`
    unknown arp style: '${e}'
  `.trim())}function ne(e){return'function'==typeof e&&'GeneratorFunction'===e.constructor.name}function te(e){return ne(e)?e:function*(){for(;;)yield e}}function ae(...e){return function*(){for(const n=e.map((e)=>te(e)());;){const e=n.map((e)=>e.next());if(e.some(({done:e})=>e))break;yield e.map(({value:e})=>e)}}}function re(e,t=1){return e=te(e),t=te(t),Te(function*(){const a=e(),r=t();loop:for(;;){for(const e of r){const n=se(a,e);if(0===n.length)break loop;if(yield n,n.length<e)break loop}break loop}})}function se(e,t){const n=[];for(let a=0;a<t;a++){const{value:t,done:a}=e.next();if(a)break;n.push(t)}return n}function*de(e){ne(e)?yield*e():yield e}function ie(...e){const n=e.pop(),t=ae(...e);return Te(function*(){for(const e of t())yield*de(n(...e))})}function oe(...e){return Te(function*(){for(const n of e)for(const e of n())yield e})}function ue(e,n=1){return Te(function*(){let t=0;for(const a of e())n<=t++&&(yield a)})}function*ce(e){let n=0;for(const t of e)yield[n++,t]}function me(e){return ne(e)?function*(){for(const n of e())yield()=>n}:function*(){for(;;)yield e}}function pe(e,n){return e=ae(e,me(n)),Te(function*(){const n=e();for(const[e,[t,a]]of ce(n))a(t,e,n)&&(yield t)})}function fe(...e){const n=ae(...e);return Te(function*(){for(const e of n())for(const n of e)yield n})}function _e(e,n=1){return Te(function*(){for(let t=0;t<n;)for(const a of e())if(yield a,n<=++t)break})}function he(e){return Te(function*(){for(;;)for(const n of e())yield n})}function ye(e,n){return Te(function*(){const t=e();for(const[e,a]of ce(t))yield*de(n(a,e,t))})}function ve(e,n){return e=ae(e,me(n)),Te(function*(){const n=e();for(const[e,[t,a]]of ce(n))a(t,e,n)||(yield t)})}function be(e,n,t=0){return Te(function*(){const a=e();for(const[e,r]of ce(a))yield*de(t=n(t,r,e,a))})}function xe(e,t=2){return e=ae(e,t),Te(function*(){for(const[n,t]of e())for(let e=0;e<t;e++)yield n})}function Ie(e,n,t){return e=ae(e,me(n)),Te(function*(){const n=e();for(const[e,[a,r]]of ce(n))r(a,e,n)?yield a:'undefined'!=typeof t&&(yield*de(t))})}function Re(e,n=1){return Te(function*(){let t=0;for(const a of e())if(t++<n)yield a;else break})}function Oe(e,n){return e=ae(e,me(n)),Te(function*(){const n=e();for(const[e,[t,a]]of ce(n)){if(a(t,e,n))break;yield t}})}function Ae(e,n){return e=ae(e,me(n)),Te(function*(){const n=e();for(const[e,[t,a]]of ce(n)){if(!a(t,e,n))break;yield t}})}function Te(e){return Ne(e,'chunk',re),Ne(e,'combine',ie),Ne(e,'concat',oe),Ne(e,'drop',ue),Ne(e,'filter',pe),Ne(e,'lace',fe),Ne(e,'length',_e),Ne(e,'loop',he),Ne(e,'map',ye),Ne(e,'reject',ve),Ne(e,'scan',be),Ne(e,'stutter',xe),Ne(e,'sub',Ie),Ne(e,'take',Re),Ne(e,'until',Oe),Ne(e,'while',Ae),Ne(e,'zip',lr),e}function Ne(e,n,t){Object.defineProperty(e,n,{value:(...n)=>t(e,...n),enumerable:!1,writable:!0,configurable:!0})}function ke(e){return e[0|fr.random()*e.length]}function Ee(e,n=1){return Te(function*(){for(let t=0;t<n;t++)for(const n of e)yield*de(n)})}function Ce(){}function Se(){Se.init.call(this)}function Le(e){return void 0===e._maxListeners?Se.defaultMaxListeners:e._maxListeners}function Fe(e,n,t){if(n)e.call(t);else for(var a=e.length,r=ze(e,a),s=0;s<a;++s)r[s].call(t)}function we(e,n,t,a){if(n)e.call(t,a);else for(var r=e.length,s=ze(e,r),d=0;d<r;++d)s[d].call(t,a)}function Pe(e,n,t,a,r){if(n)e.call(t,a,r);else for(var s=e.length,d=ze(e,s),o=0;o<s;++o)d[o].call(t,a,r)}function Be(e,n,t,a,r,s){if(n)e.call(t,a,r,s);else for(var d=e.length,o=ze(e,d),u=0;u<d;++u)o[u].call(t,a,r,s)}function De(e,n,t,a){if(n)e.apply(t,a);else for(var r=e.length,s=ze(e,r),d=0;d<r;++d)s[d].apply(t,a)}function Me(e,n,t,a){var r,s,d;if('function'!=typeof t)throw new TypeError('"listener" argument must be a function');if(s=e._events,s?(s.newListener&&(e.emit('newListener',n,t.listener?t.listener:t),s=e._events),d=s[n]):(s=e._events=new Ce,e._eventsCount=0),!d)d=s[n]=t,++e._eventsCount;else if('function'==typeof d?d=s[n]=a?[t,d]:[d,t]:a?d.unshift(t):d.push(t),!d.warned&&(r=Le(e),r&&0<r&&d.length>r)){d.warned=!0;var i=new Error('Possible EventEmitter memory leak detected. '+d.length+' '+n+' listeners added. Use emitter.setMaxListeners() to increase limit');i.name='MaxListenersExceededWarning',i.emitter=e,i.type=n,i.count=d.length,qe(i)}return e}function qe(n){'function'==typeof console.warn?console.warn(n):console.log(n)}function Ue(e,n,t){function a(){e.removeListener(n,a),r||(r=!0,t.apply(e,arguments))}var r=!1;return a.listener=t,a}function $e(e){var n=this._events;if(n){var t=n[e];if('function'==typeof t)return 1;if(t)return t.length}return 0}function Ge(e,t){for(var a=t,r=a+1,s=e.length;r<s;a+=1,r+=1)e[a]=e[r];e.pop()}function ze(e,n){for(var t=Array(n);n--;)t[n]=e[n];return t}function He(e){for(var n=Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];return n}function Ke(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}}function je(e,n){const t='string'==typeof n[n.length-1];switch(n.length){case 1:if(t)return[e,e.nextBufId(),0,0,n[0]];if('number'==typeof n[0])return[e,e.nextBufId(),1,n[0],null];break;case 2:if(t)return[e,n[0],0,0,n[1]];if('number'==typeof n[0]&&'number'==typeof n[1])return[e,e.nextBufId(),n[0],n[1],null];break;case 3:if('number'==typeof n[0]&&'number'==typeof n[1]&&'number'==typeof n[2])return[e,n[0],n[1],n[2],null];}throw TypeError(`
    Provided parameters for Buffer constructor is invalid.
  `.trim())}function Ve(e){return!!(e&&Object.getPrototypeOf(e)===Object.prototype)}function We(e){return!!(e&&'string'==typeof e.name&&Array.isArray(e.units))}function Xe(e){const n={},t=[],a=[];return e.paramValues&&e.paramIndices&&e.paramIndices.forEach(({name:t,index:a,length:r})=>{if(/^[a-z]\w*$/.test(t)){const s=e.paramValues.slice(a,a+r);n[t]={name:t,index:a,length:r,values:s}}}),e.units.forEach((e,n,r)=>{const s=e[Ir];if('Out'===s||'In'===s){const n=e[Ar][0],d=r[n[0]];if(d&&'Control'===d[Ir]&&d[Rr]===Ya){const r=e[Rr],i=d[Or]+n[1];'Out'===s?a.push({rate:r,index:i,length:e[Ar].length-1}):t.push({rate:r,index:i,length:e[Tr].length})}}}),{ctls:n,inputs:t,outputs:a}}function Ye(e){return Nr[e]?Nr[e]:[e,0]}function Ze(e,n){return n?e.sort((e,t)=>{return e=n.includes(e.name)?n.indexOf(e.name):Infinity,t=n.includes(t.name)?n.indexOf(t.name):Infinity,e-t}):e}function Qe(e){const n=[],t=[];return Object.keys(e).map((n)=>{return e[n]}).sort((e,n)=>{return e.index-n.index}).forEach(({unit:e,values:a,indices:r})=>{const s=n.length,d=a.length;n.push(...a),Object.keys(r).sort((e,n)=>{return r[e].index-r[n].index}).forEach((e)=>{const n=r[e].index+s,a=r[e].length;t.push({name:e,index:n,length:a})}),e[2]=s,e[4]=Array.from({length:d},()=>e[1])}),{paramValues:n,paramIndices:t}}function Je(e){const n=e.type.slice(1);return new TypeError(`
    Invalid control '${n}'
  `.trim())}function en(e){return e.replace(/~\d+$/,'')}function nn(e){return'!'===e.type[0]?'tr':rn(e)}function tn(e){return{ir:'Control',kr:'Control',ar:'AudioControl',tr:'TrigControl'}[e]}function an(e){return e.type+'.'+rn(e)}function rn(e){return{demand:'dr',audio:'ar',control:'kr',scalar:'ir'}[e.rate]}function sn(e){return{demand:3,audio:2,control:1,scalar:0}[e.rate]}function dn(e){function n(e){let n='';for(;o<a.length;){const t=a.charAt(o++);if(n+=t,'\\'===t)n+=a.charAt(o++);else if(t===e)break}return n}const t=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,a=e.toString().replace(t,''),r=a.match(/^(?:async\s+)?([a-zA-Z_$][\w$]*)\s*=>?/);if(null!==r)return[r[1]];const s=[];let d=0,i='',o=a.indexOf('(')+1;for(;o<a.length;){const e=a.charAt(o++);if(0==d){if(')'===e)break;if(','===e){s.push(i.trim()),i='';continue}}i+=e,'['===e||'{'===e||'('===e?d+=1:']'===e||'}'===e||')'===e?d-=1:'\''===e||'"'===e||'`'===e?i+=n(e):void 0}return i=i.trim(),i&&s.push(i),s}function on(e,n,t){null==t&&(t=dn(n));const a=[],r=[],s={inputs:[],outputs:[]},d=ln(s),i=cn(s);t.forEach((e)=>{const[n,t]=e.split('=').map((e)=>e.trim());if('$in'===n)a.push(d);else if('$out'===n)a.push(i);else if('$scapi'===n||'{'===n.charAt(0))a.push(Xa);else{const[e,s]=n.split('$'),d=t?JSON.parse(t):0;a.push(un(e,s,d)),r.push(e)}});const o=n(...a);'undefined'!=typeof o&&(0===o.type?s.outputs.push(o):i(o));const u=s.outputs.filter((e)=>{return e&&0===e.type});return Er.build(''+e,u,r)}function un(e,n,t){return'ar'===n?Cr.ar(e,t):'ir'===n?Cr.ir(e,t):'tr'===n?Cr.tr(e,t):Cr.kr(e,t)}function ln({inputs:e}){function n(n,t=1){const a=Cr.ir('in'),r=n(a,t);return a.type+=`:${e.length}`,e.push(r),r}const t=(e)=>n(Sr.ar,e);return t.ar=(e)=>n(Sr.ar,e),t.kr=(e)=>n(Sr.kr,e),t}function cn({outputs:e}){function n(n,t){const a=Cr.ir('out'),r=n(a,t);return a.type+=`:${e.length}`,e.push(r),0}const t=(e)=>n(Lr,e);return t.ar=(e)=>n(Lr.ar,e),t.kr=(e)=>n(Lr.kr,e),t}function mn(e){return e.name||`temp-${Jn(Math.random()*et)}`}function pn(e,n){return e._.doneDRecv?n:e.context.commands.d_recv(e.sdef,n)}function gn(e,n){switch(n.length){case 1:if(We(n[0]))return[e,n[0],{}];if('function'==typeof n[0])return gn(e,[on(mn(n[0]),n[0])]);break;case 2:if(We(n[0])&&Ve(n[1]))return[e,n[0],n[1]];if('string'==typeof n[0]&&'function'==typeof n[1])return gn(e,[on(n[0],n[1])]);if('function'==typeof n[0]&&Array.isArray(n[1]))return gn(e,[on(mn(n[0]),n[0],n[1])]);if('function'==typeof n[0]&&Ve(n[1]))return gn(e,[on(mn(n[0]),n[0]),n[1]]);break;case 3:if('string'==typeof n[0]&&'function'==typeof n[1]&&Array.isArray(n[2]))return gn(e,[on(n[0],n[1],n[2])]);if('string'==typeof n[0]&&'function'==typeof n[1]&&Ve(n[2]))return gn(e,[on(n[0],n[1]),n[2]]);break;case 4:if('string'==typeof n[0]&&'function'==typeof n[1]&&Array.isArray(n[2])&&Ve(n[3]))return gn(e,[on(n[0],n[1],n[2]),n[3]]);}throw TypeError(`
    Provided parameters for SDef constructor is invalid.
  `.trim())}function _n(e,n){if(n[0]=hn(e,n[0]),n[0]instanceof Fr)switch(n.length){case 1:return[e,n[0],null,null,null];case 2:if(Ve(n[1]))return[e,n[0],n[1],null,null];if(n[1]instanceof wr)return[e,n[0],null,n[1],null];break;case 3:if(Ve(n[1])&&n[2]instanceof wr)return[e,n[0],n[1],n[2],null];if(n[1]instanceof wr&&'string'==typeof n[2])return[e,n[0],null,n[1],n[2]];break;case 4:if(Ve(n[1])&&n[2]instanceof wr&&'string'==typeof n[3])return[e,n[0],n[1],n[2],n[3]];}throw TypeError(`
    Provided parameters for Instrument constructor is invalid.
  `.trim())}function hn(e,n){return'string'==typeof n?e.getSDefByName(n):'function'==typeof n?new Fr(e,on(mn(n),n)):We(n)?new Fr(e,n):n}function yn(e){return Dr[e]||0}function vn(e){return'number'==typeof e?0|e:e&&'number'==typeof e.nodeId?0|e.nodeId:0}function bn(e,n){switch(n.length){case 0:return[e,e.nextNodeId(),e.rootNode,'addToHead'];case 1:if('number'==typeof n[0])return[e,n[0],e.rootNode,'addToHead'];if(n[0]instanceof wr)return[e,e.nextNodeId(),n[0],'addToHead'];break;case 2:if('number'==typeof n[0]&&n[1]instanceof wr)return[e,n[0],n[1],'addToHead'];if(n[0]instanceof wr&&'string'==typeof n[1])return[e,e.nextNodeId(),n[0],n[1]];break;case 3:if('number'==typeof n[0]&&n[1]instanceof wr&&'string'==typeof n[2])return[e,n[0],n[1],n[2]];}throw TypeError(`
    Provided parameters for Group constructor is invalid.
  `.trim())}function xn(e,n){if(n[0]=An(e,n[0]),n[0]instanceof Br)switch(n.length){case 1:return[e,n[0],{},e.nextNodeId(),null,null];case 2:if(Rn(n[1]))return[e,n[0],n[1],e.nextNodeId(),null,null];if('number'==typeof n[1])return[e,n[0],{},n[1],null,null];if(n[1]instanceof wr)return[e,n[0],{},e.nextNodeId(),n[1],null];break;case 3:if(Rn(n[1])&&'number'==typeof n[2])return[e,n[0],n[1],n[2],null,null];if(Rn(n[1])&&n[2]instanceof wr)return[e,n[0],n[1],e.nextNodeId(),n[2],null];if('number'==typeof n[1]&&n[2]instanceof wr)return[e,n[0],{},n[1],n[2],null];if(n[1]instanceof wr&&'string'==typeof n[2])return[e,n[0],{},e.nextNodeId(),n[1],n[2]];break;case 4:if(Rn(n[1])&&'number'==typeof n[2]&&n[3]instanceof wr)return[e,n[0],n[1],n[2],n[3],null];if(Rn(n[1])&&n[2]instanceof wr&&'string'==typeof n[3])return[e,n[0],n[1],e.nextNodeId(),n[2],n[3]];if('number'==typeof n[1]&&n[2]instanceof wr&&'string'==typeof n[3])return[e,n[0],{},n[1],n[2],n[3]];break;case 5:if(Rn(n[1])&&'number'==typeof n[2]&&n[3]instanceof wr&&'string'==typeof n[4])return[e,n[0],n[1],n[2],n[3],n[4]];}throw TypeError(`
    Provided parameters for Synth constructor is invalid.
  `.trim())}function Rn(e){return Ve(e)||Array.isArray(e)}function On(e,n){const t=n.ctlNames;return e.reduce((e,n,a)=>{return e[t[a]]=n,e},{})}function An(e,n){return'string'==typeof n&&(n=e.getSDefByName(n)),'function'==typeof n&&(n=new Fr(e,on('@@'+mn(n),n),{noRegister:!0})),We(n)&&(n=Object.assign({},n,{name:`@@${n.name}`}),n=new Fr(e,n,{noRegister:!0})),n instanceof Fr&&(n=new Br(e,n)),n}function Tn(e,n,t){const a=[],r=n.ctlNames;return r.filter((e)=>t.hasOwnProperty(e)).forEach((e)=>{const{index:r,length:s}=n.ctls(e);if(t[e]instanceof vr){const n=t[e];n.rate===Qa?a.push(r,'a'+n.index):a.push(r,'c'+n.index)}else{const n=En(t[e]);if(n.length!==s)throw new TypeError(`
          ctl['${e}'] require ${s} items, but got ${n.length} items.
        `.trim());1===n.length?a.push(r,n[0]):a.push(r,n)}}),a}function Nn(e,n,t){const a=[],r=n.numberOfInputs,s=En(t.$in),d=1===s.length&&s[0]instanceof qr;return Array.from({length:r},(t,r)=>{const{rate:i,index:o,length:u}=n.inputs(r),l=d?s[0].outputs(r):s[r];let c;c=null==l?e.allocBus(i,u).index:l instanceof vr?Cn(l,'input',r,i,u):Sn(l),a.push(o,{type:'integer',value:c})}),a}function kn(e,n,t){const a=[],r=n.numberOfOutputs,s=En(t.$out),d=1===s.length&&s[0]instanceof qr;let o=0,u=0;return Array.from({length:r},(e,t)=>{const{rate:r,index:i,length:l}=n.outputs(t),c=d?s[0].inputs(t):s[t];let m;m=null==c?r===Qa?o:u:c instanceof vr?Cn(c,'output',t,r,l):Sn(c),a.push(i,{type:'integer',value:m}),r===Qa?o=m+l:u=m+l}),a}function En(e){return null==e?[]:Array.isArray(e)?e:[e]}function Cn(e,n,t,a,r){if(e.rate!==a)throw new TypeError(`
      ${n}s[${t}] require ${Ln(a)} rate, but got ${Ln(e.rate)} rate.
    `.trim());if(e.length!==r)throw new TypeError(`
      ${n}s[${t}] require ${r} channels, but got ${e.length} channels.
    `.trim());return e.index}function Sn(e){return'number'==typeof e?0|e:0}function Ln(e){return['scalar','control','audio','demand'][e]||'unknown'}function Fn(e,n){return'undefined'==typeof e?n:e}function wn(e,n){return[e,...n]}function Pn(e,n){return[e,...n]}function Bn(e,n){return[e,...n]}function Dn(e,n,t,a){return t/=e.length,e.forEach((e,r)=>{null!=e&&(Array.isArray(e)?Dn(e,n+t*r,t,a):a.push({pos:n+t*r,payload:e}))}),a}function Mn(e,n){return Array.isArray(e)?e[n%e.length]:e&&'function'==typeof e.next?e.next().value:e}function qn(e){return ne(e)?Ee([e],Infinity)():e}function Un(e,n){return e=Object.assign({},Xr,e),null==e.ServerClass&&(e.ServerClass=n(e)),new Wr(e)}function $n(e){return Object.assign(new hr(null),Ja,e.createAPI(),ur,_r,{scapi:Xa})}function Gn(e){return!!(e&&Array.isArray(e.elements))}function zn(e,n){return Gn(e)?Object.assign({},e,{elements:e.elements.concat(n)}):{timetag:[0,1],elements:[e,n]}}function Hn(e){const n=e+2208988800,t=n>>>0;return[t,4294967296*(n-t)>>>0]}function Kn(e,n){return Gn(n)?Object.assign({},n,{timetag:Hn(e)}):{timetag:Hn(e),elements:[n]}}function jn(e){return{type:'integer',value:0|e}}function Vn(e){return{type:'float',value:+e}}function Wn(e){return{type:'string',value:''+e}}function Xn(e){return{type:'blob',value:e}}function Yn(e,n){return e.map((e,t)=>{return n[t%n.length](e)})}var Zn=Math.ceil,Qn=Math.max,Jn=Math.floor,et=Number.MAX_SAFE_INTEGER;u.ar=function(e,n){return l('#',e,'audio',n)},u.kr=function(e,n){return l('#',e,'control',n)},u.ir=function(e,n){return l('#',e,'scalar',n)},u.tr=function(e,n){return l('!',e,'control',n)};var nt=p(function(e,n=2){return Array.from({length:n},()=>e)}),tt=p(function(e){return g(e,(...e)=>y(...e))}),at=p(function(e){return n(()=>e)}),rt=Object.freeze({ctl:u,dup:nt,mix:tt,ref:at}),st=I('abs',Math.abs),dt=I('acos',Math.acos),it=p(R),ot=I('asin',Math.asin),ut=I('atan',Math.atan),ct=I('ceil',Math.ceil),mt=I('cos',Math.cos),pt=I('cosh',Math.cosh),ft=I('cubed',(e)=>e*e*e),_t=O('/',(e,n)=>e/n),ht=I('exp',Math.exp),yt=I('floor',Math.floor),vt=I('frac',(e)=>e%1),bt=O('>=',(e,n)=>e>=n),xt=O('>',(e,n)=>e>n),It=O('//',(e,n)=>Jn(e/n)),Rt=O('<=',(e,n)=>e<=n),Ot=I('log',Math.log),At=I('log2',Math.log2),Tt=I('log10',Math.log10),Nt=O('<',(e,n)=>e<n),kt=p(T),Et=O('max',Math.max),Ct=I('midicps',(e)=>440*Math.pow(2,(e-69)/12)),St=O('min',Math.min),Lt=O('%',(e,n)=>e%n),Ft=p(N),wt=I('neg',(e)=>-e),Pt=I('rand',(e)=>Math.random()*e),Bt=I('rand2',(e)=>(2*Math.random()-1)*e),Dt=I('reciprocal',(e)=>1/e),Mt=I('sign',Math.sign),qt=I('sin',Math.sin),Ut=I('sinh',Math.sinh),$t=I('sqrt',Math.sqrt),Gt=I('squared',(e)=>e*e),zt=O('-',(e,n)=>e-n),Ht=I('tan',Math.tan),Kt=I('tanh',Math.tanh),jt=Object.freeze({abs:st,acos:dt,add:it,asin:ot,atan:ut,ceil:ct,cos:mt,cosh:pt,cubed:ft,div:_t,exp:ht,floor:yt,frac:vt,ge:bt,gt:xt,idiv:It,le:Rt,log:Ot,log2:At,log10:Tt,lt:Nt,madd:kt,max:Et,midicps:Ct,min:St,mod:Lt,mul:Ft,neg:wt,rand:Pt,rand2:Bt,reciprocal:Dt,sign:Mt,sin:qt,sinh:Ut,sqrt:$t,squared:Gt,sub:zt,tan:Ht,tanh:Kt}),Vt=P('AllpassC',[['maxDelayTime',0.2],['delayTime',0.2],['decayTime',1]]),Wt=P('AllpassL',[['maxDelayTime',0.2],['delayTime',0.2],['decayTime',1]]),Xt=P('AllpassN',[['maxDelayTime',0.2],['delayTime',0.2],['decayTime',1]]);const Yt=[['bufnum',0]];var Zt=B('BufChannels'),Qt=B('BufDur'),Jt=B('BufFrames'),ea=B('BufRateScale'),na=F('BufRd',[['numChannels',1],['bufnum',0],['phase',0],['loop',1],['interpolation',2]],{rates:{ar:'audio',kr:'control'},defaultRate:(e)=>e[1].rate,createNode:w(1),multiOut:(e)=>e.shift()}),ta=B('BufSampleRate'),aa=B('BufSamples'),ra=F('BufWr',[['inputs',0],['bufnum',0],['phase',0],['loop',1]],{rates:{ar:'audio',kr:'control'},composeArgs:(e)=>e.concat(e.shift()),defaultRate:(e)=>e[1].rate,createNode:w(1)}),sa=P('CombC',[['maxDelayTime',0.2],['delayTime',0.2],['decayTime',1]]),da=P('CombL',[['maxDelayTime',0.2],['delayTime',0.2],['decayTime',1]]),ia=P('CombN',[['maxDelayTime',0.2],['delayTime',0.2],['decayTime',1]]),oa=P('DelayC',[['maxDelayTime',0.2],['delayTime',0.2]]),ua=P('DelayL',[['maxDelayTime',0.2],['delayTime',0.2]]),la=P('DelayN',[['maxDelayTime',0.2],['delayTime',0.2]]),ca=F('Dust~',[['density',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',madd:!0});const ma=(...e)=>{return ma.new(...e)};ma.new=E([['levels',0],['times',0],['curve','lin'],['releaseNode',-99],['loopNode',-99]],(e,n,t,a,r)=>{return e=D(s(e)),n=D(s(n)),M(e,n,t,a,r)}),ma.tri=E([['dur',1],['level',1]],(e,n)=>{const t=[N(e,0.5),N(e,0.5)];return M([0,n,0],t,'lin')}),ma.sine=E([['dur',1],['level',1]],(e,n)=>{const t=[N(e,0.5),N(e,0.5)];return M([0,n,0],t,'sine')}),ma.perc=E([['attackTime',0.01],['releaseTime',1],['level',1],['curve',-4]],(e,n,t,a)=>{return M([0,t,0],[e,n],a)}),ma.linen=E([['attackTime',0.01],['sustainTime',1],['releaseTime',1],['level',1],['curve','lin']],(e,n,t,a,r)=>{return M([0,a,a,0],[e,n,t],r)}),ma.step=E([['levels',0],['times',0],['releaseNode',-99],['loopNode',-99]],(e,n,t,a)=>{return e=D(s(e)),n=D(s(n)),e=[e[0]].concat(e),M(e,n,'step',t,a)}),ma.cutoff=E([['releaseTime',0.1],['level',1],['curve','lin']],(e,n,t)=>{const a=U(t),r=2===a?1e-5:0;return M([n,r],[e],t,0)}),ma.dadsr=E([['delayTime',0.1],['attackTime',0.01],['decayTime',0.3],['sustainLevel',0.5],['releaseTime',1],['peakLevel',1],['curve',-4],['bias',0]],(e,n,t,a,r,s,d,i)=>{const o=[0,0,s,N(s,a),0].map((e)=>R(e,i));return M(o,[e,n,t,r],d,3)}),ma.adsr=E([['attackTime',0.01],['decayTime',0.3],['sustainLevel',0.5],['releaseTime',1],['peakLevel',1],['curve',-4],['bias',0]],(e,n,t,a,r,s,d)=>{const i=[0,r,N(r,t),0].map((e)=>R(e,d));return M(i,[e,n,a],s,2)}),ma.asr=E([['attackTime',0.01],['sustainLevel',0.5],['releaseTime',1],['curve',-4],['bias',0]],(e,n,t,a,r)=>{const s=[0,n,0].map((e)=>R(e,r));return M(s,[e,t],a,1)});const pa={stp:0,step:0,lin:1,linear:1,exp:2,exponential:2,sin:3,sine:3,wel:4,welch:4,sqr:6,squared:6,cub:7,cubed:7,hld:8,hold:8};var fa=F('EnvGen',[['env',0],['gate',1],['levelScale',1],['levelBias',0],['timeScale',1]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',action:!0,createNode:function(e,n,[t,a,r,i,o,u]){const l=D(s(t));if(!z(l))throw new TypeError(`
      Invalid envelope parameters.
    `.trim());return d(e,n,[a,r,i,o,u].concat(l))}}),ga=F('ExpRand~',[['lo',0.01],['hi',1]],{rates:{new:'scalar'},defaultRate:'scalar'}),_a=P('FreeVerb',[['mix',0.33],['room',0.5],['dump',0.5]]),ha=F('Impulse',[['freq',440],['phase',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',madd:!0}),ya=F('In',[['bus',0],['numChannels',1]],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',multiOut:(e)=>e.pop()}),va=F('IRand~',[['lo',0],['hi',127]],{rates:{new:'scalar'},defaultRate:'scalar'}),ba=F('Klank',[['ref',0],['in',0],['freqScale',1],['freqOffset',0],['decayScale',1]],{rates:{ar:'audio'},defaultRate:'audio',createNode:function(e,n,t){const[a,r,s,i,o]=t;let[u,l,c]=a.valueOf();u=D(u),l=null==l?[1]:D(l),c=null==c?[1]:D(c);const m=Qn(u.length,l.length,c.length),p=Array.from({length:3*m},(e,n)=>{return f([u,l,c][n%3],0|n/3)});return d(e,n,[r,s,i,o].concat(p))}}),xa=F('LFCub',[['freq',440],['iphase',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),Ia=F('LFNoise0~',[['freq',500]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),Ra=F('LFNoise1~',[['freq',500]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),Oa=F('LFNoise2~',[['freq',500]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),Aa=F('LFPar',[['freq',440],['iphase',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),Ta=F('LFPulse',[['freq',440],['iphase',0],['width',0.5]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),Na=F('LFSaw',[['freq',440],['iphase',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),ka=F('LFTri',[['freq',440],['iphase',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0}),Ea=F('Line',[['start',1],['end',0],['dur',1]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0,action:!0}),Ca=F('MouseX',[['min',0],['max',1],['warp',0],['lag',0.2]],{rates:{kr:'control'},defaultRate:'control'}),Sa=F('MouseY',[['min',0],['max',1],['warp',0],['lag',0.2]],{rates:{kr:'control'},defaultRate:'control'});const La=j('audio');La.ar=j('audio'),La.kr=j('control');var Fa=F('Pan2',[['in',0],['pos',0],['level',1]],{rates:{ar:'audio',kr:'control'},defaultRate:null,createNode:w(0),multiOut:2}),wa=F('Phasor',[['trig',0],['rate',1],['start',0],['end',1],['reset',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'audio'}),Pa=F('PinkNoise~',[],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',madd:!0}),Ba=F('PlayBuf',[['numChannels',1],['bufnum',0],['rate',1],['trig',1],['startPos',0],['loop',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',action:!0,multiOut:(e)=>e.shift()}),Da=F('Rand~',[['lo',0],['hi',1]],{rates:{new:'scalar'},defaultRate:'scalar'}),Ma=P('RHPF',[['freq',440],['rq',1]]),qa=P('RLPF',[['freq',440],['rq',1]]),Ua=F('SinOsc',[['freq',440],['phase',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',madd:!0}),$a=F('SinOscFB',[['freq',440],['fee,dback',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',madd:!0}),Ga=F('TExpRand~',[['lo',0.01],['hi',1],['trig',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'control'}),za=F('TIRand~',[['lo',0],['hi',127],['trig',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'control'}),Ha=F('TRand~',[['lo',0],['hi',1],['trig',0]],{rates:{ar:'audio',kr:'control'},defaultRate:'control'}),Ka=F('WhiteNoise~',[],{rates:{ar:'audio',kr:'control'},defaultRate:'audio',madd:!0}),ja=F('XLine',[['start',1],['end',0.01],['dur',1]],{rates:{ar:'audio',kr:'control'},defaultRate:'control',madd:!0,action:!0}),Va=Object.freeze({AllpassC:Vt,AllpassL:Wt,AllpassN:Xt,BufChannels:Zt,BufDur:Qt,BufFrames:Jt,BufRateScale:ea,BufRd:na,BufSampleRate:ta,BufSamples:aa,BufWr:ra,CombC:sa,CombL:da,CombN:ia,DelayC:oa,DelayL:ua,DelayN:la,Dust:ca,Env:ma,EnvGen:fa,ExpRand:ga,FreeVerb:_a,Impulse:ha,In:ya,IRand:va,Klank:ba,LFCub:xa,LFNoise0:Ia,LFNoise1:Ra,LFNoise2:Oa,LFPar:Aa,LFPulse:Ta,LFSaw:Na,LFTri:ka,Line:Ea,MouseX:Ca,MouseY:Sa,Out:La,Pan2:Fa,Phasor:wa,PinkNoise:Pa,PlayBuf:Ba,Rand:Da,RHPF:Ma,RLPF:qa,SinOsc:Ua,SinOscFB:$a,TExpRand:Ga,TIRand:za,TRand:Ha,WhiteNoise:Ka,XLine:ja});var Wa=Object.freeze({NO_ACTION:0,PAUSE:1,FREE:2,FREE_AND_BEFORE:3,FREE_AND_AFTER:4,FREE_AND_GROUP_BEFORE:5,FREE_AND_GROUP_AFTER:6,FREE_UPTO_THIS:7,FREE_FROM_THIS_ON:8,FREE_PAUSE_BEFORE:9,FREE_PAUSE_AFTER:10,FREE_AND_GROUP_BEFORE_DEEP:11,FREE_AND_GROUP_AFTER_DEEP:12,FREE_CHILDREN:13,FREE_GROUP:14}),Xa=Object.assign({},rt,jt,Va,Wa);const Ya=0,Za=1,Qa=2;var Ja=Object.freeze({SCALAR:Ya,CONTROL:Za,AUDIO:Qa,DEMAND:3});const er=[0,4,7],nr=[0,3,7],tr=[0,4,7,11],ar=[0,4,7,10],rr=[0,3,7,10],sr=[0,4,8],dr=[0,3,6],ir=[0,3,6,9],or={1:[0],5:[0,7],"+5":[0,4,8],"m+5":[0,3,8],sus2:[0,2,7],sus4:[0,5,7],6:[0,4,7,9],m6:[0,3,7,9],"7sus2":[0,2,7,10],"7sus4":[0,5,7,10],"7-5":[0,4,6,10],"m7-5":[0,3,6,10],"7+5":[0,4,8,10],"m7+5":[0,3,8,10],9:[0,4,7,10,14],m9:[0,3,7,10,14],"m7+9":[0,3,7,10,14],maj9:[0,4,7,11,14],"9sus4":[0,5,7,10,14],"6*9":[0,4,7,9,14],"m6*9":[0,3,9,7,14],"7-9":[0,4,7,10,13],"m7-9":[0,3,7,10,13],"7-10":[0,4,7,10,15],"9+5":[0,10,13],"m9+5":[0,10,14],"7+5-9":[0,4,8,10,13],"m7+5-9":[0,3,8,10,13],11:[0,4,7,10,14,17],m11:[0,3,7,10,14,17],maj11:[0,4,7,11,14,17],"11+":[0,4,7,10,14,18],"m11+":[0,3,7,10,14,18],13:[0,4,7,10,14,17,21],m13:[0,3,7,10,14,17,21],major:er,M:er,minor:nr,m:nr,major7:tr,dom7:ar,7:ar,M7:tr,minor7:rr,m7:rr,augmented:sr,aug:sr,a:sr,diminished:dr,dim:dr,i:dr,diminished7:ir,dim7:ir,i7:ir};var ur=Object.freeze({arp:J,note:X}),lr=function(...e){return Te(ae(...e))};const cr={random:Math.random},mr={random:Math.random},pr={random:Math.random},fr={random:Math.random};var gr,_r=Object.freeze({parp:function(e,n,t=-1,a=0){const r=ae(e,n,t,a);return Te(function*(){for(const[e,n,t,a]of r())for(const r of J(e,n,t,a))yield r})},pchunk:re,pcombine:ie,pconcat:oe,pcount:function(e=0,n=Infinity){return Te(function*(){for(let t=0;t<n;t++)yield t+e})},pdrop:ue,pexprand:function(e=0.01,n=1,t=Infinity){return Te(function*(){for(let a=0;a<t;a++)yield e*Math.exp(cr.random()*Math.log(n/e))})},pfilter:pe,pfunc:function(e,n=Infinity){return Te(function*(){for(let t=0;t<n;t++)yield*de(e(t,n))})},pirand:function(e=0,n=127,t=Infinity){return Te(function*(){for(let a=0;a<t;a++)yield Jn(mr.random()*(n-e)+e)})},place:fe,plength:_e,ploop:he,pmap:ye,prand:function(e=0,n=1,t=Infinity){return Te(function*(){for(let a=0;a<t;a++)yield pr.random()*(n-e)+e})},preject:ve,psample:function(e,n=e.length){return Te(function*(){for(let t=0;t<n;t++)yield*de(ke(e))})},pscan:be,pseq:Ee,pstutter:xe,psub:Ie,ptake:Re,puntil:Oe,pwhile:Ae,pzip:lr});Ce.prototype=Object.create(null),Se.EventEmitter=Se,Se.usingDomains=!1,Se.prototype.domain=void 0,Se.prototype._events=void 0,Se.prototype._maxListeners=void 0,Se.defaultMaxListeners=10,Se.init=function(){this.domain=null,Se.usingDomains&&gr.active&&!(this instanceof gr.Domain)&&(this.domain=gr.active),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Ce,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Se.prototype.setMaxListeners=function(e){if('number'!=typeof e||0>e||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Se.prototype.getMaxListeners=function(){return Le(this)},Se.prototype.emit=function(e){var n,t,a,r,s,d,i,o='error'===e;if(d=this._events,d)o=o&&null==d.error;else if(!o)return!1;if(i=this.domain,o){if(n=arguments[1],i)n||(n=new Error('Uncaught, unspecified "error" event')),n.domainEmitter=this,n.domain=i,n.domainThrown=!1,i.emit('error',n);else if(n instanceof Error)throw n;else{var u=new Error('Uncaught, unspecified "error" event. ('+n+')');throw u.context=n,u}return!1}if(t=d[e],!t)return!1;var l='function'==typeof t;switch(a=arguments.length,a){case 1:Fe(t,l,this);break;case 2:we(t,l,this,arguments[1]);break;case 3:Pe(t,l,this,arguments[1],arguments[2]);break;case 4:Be(t,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=Array(a-1),s=1;s<a;s++)r[s-1]=arguments[s];De(t,l,this,r);}return!1,!0},Se.prototype.addListener=function(e,n){return Me(this,e,n,!1)},Se.prototype.on=Se.prototype.addListener,Se.prototype.prependListener=function(e,n){return Me(this,e,n,!0)},Se.prototype.once=function(e,n){if('function'!=typeof n)throw new TypeError('"listener" argument must be a function');return this.on(e,Ue(this,e,n)),this},Se.prototype.prependOnceListener=function(e,n){if('function'!=typeof n)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Ue(this,e,n)),this},Se.prototype.removeListener=function(e,n){var t,a,r,s,d;if('function'!=typeof n)throw new TypeError('"listener" argument must be a function');if(a=this._events,!a)return this;if(t=a[e],!t)return this;if(t===n||t.listener&&t.listener===n)0==--this._eventsCount?this._events=new Ce:(delete a[e],a.removeListener&&this.emit('removeListener',e,t.listener||n));else if('function'!=typeof t){for(r=-1,s=t.length;0<s--;)if(t[s]===n||t[s].listener&&t[s].listener===n){d=t[s].listener,r=s;break}if(0>r)return this;if(1===t.length){if(t[0]=void 0,0==--this._eventsCount)return this._events=new Ce,this;delete a[e]}else Ge(t,r);a.removeListener&&this.emit('removeListener',e,d||n)}return this},Se.prototype.removeAllListeners=function(e){var n,t;if(t=this._events,!t)return this;if(!t.removeListener)return 0===arguments.length?(this._events=new Ce,this._eventsCount=0):t[e]&&(0==--this._eventsCount?this._events=new Ce:delete t[e]),this;if(0===arguments.length){for(var a,r=Object.keys(t),s=0;s<r.length;++s)a=r[s],'removeListener'===a||this.removeAllListeners(a);return this.removeAllListeners('removeListener'),this._events=new Ce,this._eventsCount=0,this}if(n=t[e],'function'==typeof n)this.removeListener(e,n);else if(n)do this.removeListener(e,n[n.length-1]);while(n[0]);return this},Se.prototype.listeners=function(e){var n,t,a=this._events;return a?(n=a[e],t=n?'function'==typeof n?[n.listener||n]:He(n):[]):t=[],t},Se.listenerCount=function(e,n){return'function'==typeof e.listenerCount?e.listenerCount(n):$e.call(e,n)},Se.prototype.listenerCount=$e,Se.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};class hr{constructor(e){Object.defineProperties(this,{context:Ke(e),_:Ke(Object.create(null))}),this._.emitter=new Se}on(e,n){return this._.emitter.on(e,n),this}once(e,n){return this._.emitter.once(e,n),this}addListener(e,n){return this._.emitter.addListener(e,n),this}removeListener(e,n){return this._.emitter.removeListener(e,n),this}removeAllListeners(e){return this._.emitter.removeAllListeners(e),this}emit(e,...n){return this._.emitter.emit(e,...n),this}}const{In:yr}=Xa;class vr extends hr{constructor(e,n,t,a){super(e),this.rate=n,this.index=t,this.length=a}get in(){return this.rate===Qa?yr.ar(this.index,this.length):yr.kr(this.index,this.length)}set value(e){this.set(e)}set(e){if(this.rate===Qa)throw new TypeError(`
        AudioBus cannot set value.
      `.trim());const{context:n}=this,t=n.commands.c_set(this.index,e);return n.sendOSC(t),this}setAt(e,n){if(this.rate===Qa)throw new TypeError(`
        AudioBus cannot set value.
      `.trim());if(!(0<=e&&e<this.length))throw new TypeError(`
        Control index out of range.
      `.trim());const{context:t}=this,a=t.commands.c_set(this.index+e,n);return t.sendOSC(a),this}}class br extends hr{constructor(e,n,t=1024,a=0){super(e),this.rate=n,this.length=t,this.offset=a,this._.mem=new Uint8Array(t-a),this._.pos=0}alloc(e){const n=this._findAvailablePos(this._.pos,e);if(-1===n)throw new Error(`
        BusIndexAllocator Error
      `.trim());for(let t=0;t<e;t++)this._.mem[n+t]=1;this._.pos=n+e;const t=this.rate,a=n+this.offset;return new vr(this.context,t,a,e)}free({index:e,length:n}){const t=e-this.offset;for(let a=0;a<n;a++)this._.mem[t+a]=0}_findAvailablePos(e,n){const t=this._.mem;loop:for(let a=0,r=t.length-n;a<r;a++){const r=(e+a)%t.length;for(let e=0;e<n;e++)if(t[r+e]){a+=e;continue loop}return r}return-1}}class xr extends hr{static create(e,...n){return new xr(...je(e,n))}constructor(e,n,t,a,r){super(e),this.bufId=n,this.numberOfChannels=t,this.length=a,this.source=r,this._.state='loading';const s=({numberOfChannels:n,length:t,sampleRate:a})=>{this.numberOfChannels=n,this.length=t,this.sampleRate=a,'loading'===this._.state&&(this._.state='loaded'),this.emit('created',this),e.apiEmit('buffer-created',this)};null==r?(this.sampleRate=e.sampleRate,e.allocBuffer(n,t,a,s)):(this.sampleRate=0,e.loadBuffer(n,r,s))}get state(){return this._.state}free(){const{context:e}=this,n=e.commands.b_free(this.bufId);return e.sendOSC(n,()=>{this.emit('disposed',this),e.apiEmit('buffer-disposed',this)}),this._.state='disposed',this}toSCNodeInput(){return this.bufId}}const Ir=0,Rr=1,Or=2,Ar=3,Tr=4,Nr=Object.create(null);`
neg not isNil notNil bitNot abs asFloat asInt ceil floor frac sign squared cubed sqrt exp reciprocal
midicps cpsmidi midiratio ratiomidi dbamp ampdb octcps cpsoct log log2 log10 sin cos tan asin acos
atan sinh cosh tanh rand rand2 linrand bilinrand sum3rand distort softclip coin digitvalue silence
thru rectWindow hanWindow welWindow triWindow ramp scurve
`.trim().split(/\s+/).map((e,n)=>{Nr[e]=['UnaryOpUGen',n]}),`
+ - * // / % == != < > <= >= min max & | ^ lcm gcd round roundUp trunc atan2 hypot
hypotApx pow << >> >>> fill ring1 ring2 ring3 ring4 difsqr sumsqr
sqrsum sqrdif absdif thresh amclip scaleneg clip2 excess fold2 wrap2 firstArg rrand exprand
`.trim().split(/\s+/).map((e,n)=>{Nr[e]=['BinaryOpUGen',n]});class kr{constructor(){this.consts=[],this.units=[],this.controls={},this._keyToNodeMap=new Map,this._nodeToInputsMap=new Map,this._nameToCtrlMap=new Map}collect(e){return this.isKnownNode(e)?void 0:'number'==typeof e?this.collectNumber(e):'#'===e.type[0]||'!'===e.type[0]?this.collectControl(e):0===e.type?this.collectOutput(e):'OutputProxy'===e.type?this.collectOutputProxy(e):this.collectBasicNode(e,1)}collectNumber(e){this.setInputs(e,[-1,this.consts.length]),this.consts.push(e)}collectControl(e){if(!this.findSameInputsAndRegister(e)){const n=nn(e);this.controls[n]||(this.controls[n]={unit:null,index:-1,values:[],indices:{}});const t=this.controls[n],a=tn(n),r=e.type.slice(1),[s,d,i]=e.props;if(!this._nameToCtrlMap.has(r))this._nameToCtrlMap.set(r,t);else if(this._nameToCtrlMap.get(r)!==t)throw Je(e);const{values:o,indices:u}=t;if(!u.hasOwnProperty(r))u[r]={index:o.length,length:i};else if(u[r].length!==i)throw Je(e);const l=u[r].index;if('number'==typeof o[d+l])throw Je(e);o.length=Qn(o.length,i),o[d+l]=s,null===t.unit&&(t.unit=[a,sn(e),0,[],[]],t.index=this.units.length,this.units.push(t.unit)),this.setInputs(e,[t.index,d+l])}}collectOutput(e){e.props.forEach((e)=>{this.collectBasicNode(e,0)})}collectOutputProxy(e){const[n,t,a]=e.props;this.isUnknownNode(n)&&this.collectBasicNode(n,a);this.findSameInputsAndRegister(e)||this.setInputs(e,[this.getInputs(n)[0],t])}collectBasicNode(e,n){if(e.props.forEach((e)=>{this.collect(e)}),this.findSameInputsAndRegister(e))return;this.setInputs(e,[this.units.length,0]);const[t,a]=Ye(e.type),r=sn(e),s=e.props.map((e)=>this.getInputs(e)),d=Array.from({length:n},()=>r);this.units.push([en(t),r,a,s,d])}findSameInputsAndRegister(e){const n=this.createKeyFromNode(e);return this.isUnknownKey(n)?(this.setNodeAtKey(n,e),!1):(this.setInputs(e,this.getInputs(this.getNodeAtKey(n))),!0)}createKeyFromNode(e){return'number'==typeof e?''+e:this.isKnownNode(e)?JSON.stringify(this.getInputs(e)):'OutputProxy'===e.type?an(e)+' '+JSON.stringify([this.getInputs(e.props[0])[0],e.props[1]]):'#'===e.type[0]||'!'===e.type[1]?an(e)+' '+e.props.join(' '):an(e)+' '+e.props.map((e)=>{return this.createKeyFromNode(e)}).join(' ')}isUnknownKey(e){return!this._keyToNodeMap.has(e)}setNodeAtKey(e,n){this._keyToNodeMap.set(e,n)}getNodeAtKey(e){return this._keyToNodeMap.get(e)}setInputs(e,n){this._nodeToInputsMap.set(e,n)}getInputs(e){return this._nodeToInputsMap.get(e)}isKnownNode(e){return this._nodeToInputsMap.has(e)}isUnknownNode(e){return!this._nodeToInputsMap.has(e)}}var Er={build:function(e,n,t){const a=new kr;n.forEach((e)=>{a.collect(e)});const{consts:r,units:s,controls:d}=a,{paramValues:i,paramIndices:o}=Qe(d),u={};return u.name=e,u.consts=r,0!==i.length&&(u.paramValues=i,u.paramIndices=Ze(o,t)),u.units=s,u}};const{ctl:Cr,In:Sr,Out:Lr}=Xa;class Fr extends hr{static create(e,...n){return new Fr(...gn(e,n))}constructor(e,n,t={}){super(e),this.sdef=n;const a=Xe(n);this._.ctls=a.ctls,this._.inputs=a.inputs,this._.outputs=a.outputs,this._.sendFlag=!1,this._.doneDRecv=!1,this._.ctlNames=n.paramIndices?n.paramIndices.map(({name:e})=>e).filter((e)=>{return a.ctls.hasOwnProperty(e)}):[],t.noSend||this.send(),t.noRegister||n.name.startsWith('@@')||e.registerSDef(this)}get name(){return this.sdef.name}get ctlNames(){return this._.ctlNames}get numberOfInputs(){return this._.inputs.length}get numberOfOutputs(){return this._.outputs.length}ctls(e){return this._.ctls[e]||null}inputs(e){return this._.inputs[0|e]||null}outputs(e){return this._.outputs[0|e]||null}free(){const{context:e}=this,n=e.commands.d_free(this.name);return e.sendOSC(n),e.unregisterSDef(this),this}send(){const{context:e}=this;return this._.sendFlag||(e.sendOSC(e.commands.d_recv(this.sdef),()=>{this._.doneDRecv=!0}),this._.sendFlag=!0),this}}class wr extends hr{constructor(e,n){super(e),this.nodeId=n,this.isNode=!0,this.ctl=new Proxy(this,Pr),this._.state='creating',e.registerNode(this)}get state(){return this._.state}free(){const{context:e}=this,n=e.commands.n_free(this.nodeId);return e.sendOSC(n),e.unregisterNode(this),this._.state='disposed',this}run(e=!0){const{context:n}=this,t=n.commands.n_run(this.nodeId,e);return n.sendOSC(t),this}apply(e){const{context:n}=this,t=[],a=[],r=[];Object.keys(e).forEach((n)=>{const s=e[n];s instanceof vr?s.rate===Qa?r.push(n,s.index):a.push(n,s.index):t.push(n,s)});const s=[n.commands.n_set(this.nodeId,...t),n.commands.n_map(this.nodeId,...a),n.commands.n_mapa(this.nodeId,...r)].filter((e)=>1!==e.args.length);let d;return d=1===s.length?s[0]:{timetag:[0,1],elements:s},n.sendOSC(d),this}release(e){e=null==e?0:-1*e-1;const{context:n}=this,t=n.commands.n_set(this.nodeId,'gate',e);return n.sendOSC(t),this}['/n_go'](){const{context:e}=this;this._.state='running',this.emit('created',this),this.inst&&(this.inst.emit('node-created',this),this.inst.sdef.emit('node-created',this)),e.apiEmit('node-created',this)}['/n_end'](){const{context:e}=this;this.inst&&(this._.inputs.forEach((e)=>{this.context.freeBus(e)}),this.inst.sdefName.startsWith('@@')&&this.inst.sdef.free()),this._.state='disposed',e.unregisterNode(this),this.emit('disposed',this),this.inst&&(this.inst.emit('node-disposed',this),this.inst.sdef.emit('node-disposed',this)),e.apiEmit('node-disposed',this)}['/n_off'](){const{context:e}=this;this._.state='suspended',this.emit('statechanged',this),this.inst&&(this.inst.emit('node-statechanged',this),this.inst.sdef.emit('node-statechanged',this)),e.apiEmit('node-statechanged',this)}['/n_on'](){const{context:e}=this;this._.state='running',this.emit('statechanged',this),this.inst&&(this.inst.emit('node-statechanged',this),this.inst.sdef.emit('node-statechanged',this)),e.apiEmit('node-statechanged',this)}}const Pr={set(e,n,t){return e.apply({[n]:t}),!0}};class Br extends hr{static create(e,...n){return new Br(..._n(e,n))}constructor(e,n,t=null,a=null,r=null){super(e),this.sdef=n,this._.params=t,this._.target=a,this._.action=r}get sdefName(){return this.sdef.name}get ctlNames(){return this.sdef.ctlNames}get numberOfInputs(){return this.sdef.numberOfInputs}get numberOfOutputs(){return this.sdef.numberOfOutputs}get params(){return this._.params}get target(){return this._.target}get action(){return this._.action}ctls(e){return this.sdef.ctls(e)}inputs(e){return this.sdef.inputs(e)}outputs(e){return this.sdef.outputs(e)}}const Dr=Object.assign(Object.create(null),{0:0,1:1,2:2,3:3,4:4,addToHead:0,addHead:0,head:0,h:0,addToTail:1,addTail:1,tail:1,t:1,addBefore:2,before:2,b:2,addAfter:3,after:3,a:3,addReplace:4,replace:4,r:4});class Mr extends wr{static create(e,...n){return new Mr(...bn(e,n))}constructor(e,n,t,a){super(e,n),this.isGroup=!0;const r=vn(t),s=yn(a),d=e.commands.g_new(n,s,r);e.sendOSC(d)}freeAll(){const{context:e}=this,n=e.commands.g_freeAll(this.nodeId);return e.sendOSC(n),e.unregisterNode(this),this._.state='disposed',this}deepFree(){const{context:e}=this,n=e.commands.g_deepFree(this.nodeId);return e.sendOSC(n),e.unregisterNode(this),this._.state='disposed',this}}class qr extends wr{static create(e,...n){return new qr(...xn(e,n))}constructor(e,n,t,a,r,s){super(e,a),Array.isArray(t)&&(t=On(t,n)),t=Object.assign({},n.params,t),r=null==r?null==n.target?e.rootNode:n.target:r,s=null==s?null==n.action?'addToHead':n.action:s,this.inst=n,this.isSynth=!0;const d=vn(r),i=yn(s),o=Tn(e,n,t),u=Nn(e,n,t),l=kn(e,n,t);this._.inputs=Array.from({length:n.numberOfInputs},(t,a)=>{const{rate:r,length:s}=n.inputs(a),d=u[2*a+1].value;return new vr(e,r,d,s)}),this._.outputs=Array.from({length:n.numberOfOutputs},(t,a)=>{const{rate:r,length:s}=n.outputs(a),d=l[2*a+1].value;return new vr(e,r,d,s)});const c=pn(n.sdef,e.commands.s_new(n.sdefName,this.nodeId,i,d,...o,...u,...l));e.sendOSC(c)}get ctlNames(){return this.inst.ctlNames}get numberOfInputs(){return this._.inputs.length}get numberOfOutputs(){return this._.outputs.length}inputs(e){return this._.inputs[e]||null}outputs(e){return this._.outputs[e]||null}}var Ur='undefined'==typeof global?'undefined'==typeof self?'undefined'==typeof window?{}:window:self:global;class $r extends hr{constructor(e,n={}){super(e),this.playbackTime=0,this.interval=Fn(n.interval,0.025),this.aheadTime=Fn(n.aheadTime,0.1),this.timerAPI=Fn(n.timerAPI,Ur),this.dateAPI=Fn(n.dateAPI,Date),this._.timerId=0,this._.schedId=0,this._.scheds=[]}get state(){return 0===this._.timerId?'suspended':'running'}get events(){return this._.scheds}start(){return 0===this._.timerId&&(this.playbackTime=this.dateAPI.now()/1e3,this._.timerId=this.timerAPI.setInterval(this.process.bind(this),1e3*this.interval)),this}stop(){return 0!==this._.timerId&&(this.timerAPI.clearInterval(this._.timerId),this._.timerId=0),this}sched(e,n,...t){const a=++this._.schedId,r={id:a,time:e,callback:n,args:t},s=this._.scheds;if(0===s.length||s[s.length-1].time<=e)s.push(r);else for(let n=0,t=s.length;n<t;n++)if(e<s[n].time){s.splice(n,0,r);break}return a}unsched(e){const n=this._.scheds;for(let t=0,a=n.length;t<a;t++)if(e===n[t].id){n.splice(t,1);break}return e}unschedAll(){this._.scheds.splice(0)}process(){const e=this._.scheds,n=this.dateAPI.now()/1e3,t=n+this.aheadTime;for(this.playbackTime=n,this.context.beginSched();e.length&&e[0].time<t;){const n=e.shift();this.playbackTime=n.time,n.callback(...n.args)}this.context.endSched(),this.playbackTime=t}}class Gr extends hr{constructor(e){super(e),this._.process=this.process.bind(this)}get state(){return this._.state}start(){}stop(){}resume(){}suspend(){}at(){}process(){}}class zr extends Gr{constructor(e){super(e),this._.state='suspended',this._.schedId=0}start(e){return 0===this._.schedId&&(this._.state='running','number'!=typeof e&&(e=Date.now()/1e3+0.25),this._.schedId=this._.process(e)),this}stop(){return 0!==this._.schedId&&(this.context.unsched(this._.schedId),this._.state='suspended',this._.stateId=0),this}resume(){'suspended'===this._.state&&(this._.state='running')}suspend(){'running'===this._.state&&(this._.state='suspended')}}class Hr extends zr{static create(e,...n){return new Hr(...wn(e,n))}constructor(e,n){super(e),this._.currentInterval=n,this._.nextInterval=n,this._.currentTime=0,this._.nextTime=this.at(1),this._.counter=0}get value(){return this._.nextInterval}set value(e){this._.nextInterval=e}at(e){return e=Qn(0,Math.min(e,1)),this._.currentTime+this._.currentInterval*e}process(e){const{context:n}=this;return this._.currentTime=e,'running'===this._.state&&this.emit('sync',{count:this._.counter++}),this._.currentInterval=this._.nextInterval,this._.nextTime=this.at(1),'running'===this._.state&&this.emit('@@sync'),n.sched(this._.nextTime,this._.process,this._.nextTime)}}class Kr extends Hr{static create(e,...n){return new Kr(...Pn(e,n))}constructor(e,n){super(e,1/n)}get value(){return 1/super.value}set value(e){super.value=1/e}}class jr extends Gr{constructor(e,n){super(e),this._.src=n,this._.state='running',this._.src.addListener('@@sync',this._.process)}start(e){return this._.src.start(e),this}stop(e){return this._.src.stop(e),this}suspend(){return'running'===this._.state&&(this._.state='suspended',this._.src.removeListener('@@sync',this._.process)),this}resume(){return'suspended'===this._.state&&(this._.state='running',this._.src.addListener('@@sync',this._.process)),this}at(e){return this._.src.at(e)}}class Vr extends jr{static create(e,...n){return new Vr(...Bn(e,n))}constructor(e,n,t){super(e,n),this._.params={},this._.counter=0,this._.pattern=[],this._.iter=null,t&&(this.pattern=t)}get pattern(){return this._.pattern}set pattern(e){this._.pattern=e,this._.iter=ne(e)?Ee([e],Infinity)():null}apply(e){return Object.keys(e).forEach((n)=>{null==e[n]?delete this._.params[n]:this._.params[n]=qn(e[n])}),this}process(){const{context:e}=this;this.emit('sync',{count:this._.counter++}),this.emit('@@sync');const n=this._.iter?this._.iter.next().value:this._.pattern;Dn(n,0,1,[]).forEach(({pos:n,payload:t},a)=>{e.sched(this._.src.at(n),()=>{const e=Object.keys(this._.params).reduce((e,n)=>{return e[n]=Mn(this._.params[n],a),e},{$value:t});this.emit('data',e)})})}}class Wr extends hr{constructor(e){super(null),this.context=this,this.server=new e.ServerClass(e),this.server.on('recvOSC',(e)=>{'function'==typeof this[e.address]&&this[e.address](e),this.apiEmit('recvOSC',e)}),this.commands=this.server.commands,this.sampleRate=Fn(e.sampleRate,44100),this.rootNode={nodeId:1e3},this._.timeline=new $r(this),this._.nextNodeId=this.rootNode.nodeId+1,this._.nextBufId=128,this._.sendOSCAt=!1,this._.aBusAlloc=new br(this,Qa,1024,128),this._.cBusAlloc=new br(this,Za,16384,128),this._.sdefMap=new Map,this._.nodeMap=new Map,this.sendOSC({timetag:[0,1],elements:[this.commands.notify(1),this.commands.dumpOSC(1),this.commands.clearSched(),this.commands.g_new(this.rootNode.nodeId),this.commands.g_freeAll(this.rootNode.nodeId)]})}createAPI(){return['now','sched','schedRel','unsched','unschedAll','abus','cbus','reset','buffer','sdef','inst','group','synth','metro','cps','cyclic'].reduce((e,n)=>{return e[n]=this[n].bind(this),e},{})}now(){return this._.timeline.playbackTime}sched(e,n,...t){return this._.timeline.sched(e,n,...t)}schedRel(e,n,...t){return this._.timeline.sched(this.now()+e,n,...t)}unsched(e){return this._.timeline.unsched(e)}unschedAll(e){this._.timeline.unschedAll(),this.sendOSC(this.commands.clearSched(),e)}abus(e){return this.allocBus(Qa,e)}cbus(e){return this.allocBus(Za,e)}reset(e){this._.timeline.unschedAll(),this.sendOSC({timetag:[0,1],elements:[this.commands.clearSched(),this.commands.g_freeAll(this.rootNode.nodeId)]},e)}buffer(...e){return xr.create(this,...e)}sdef(...e){return Fr.create(this,...e)}inst(...e){return Br.create(this,...e)}group(...e){return Mr.create(this,...e)}synth(...e){return qr.create(this,...e)}metro(...e){return Hr.create(this,...e)}cps(...e){return Kr.create(this,...e)}cyclic(...e){return Vr.create(this,...e)}nextNodeId(){return this._.nextNodeId++}nextBufId(){return this._.nextBufId++}allocBuffer(e,n,t,a){this.server.allocBuffer(e,n,t,a)}loadBuffer(e,n,t){this.server.loadBuffer(e,n,t)}allocBus(e,n){return e===Qa?this._.aBusAlloc.alloc(n):this._.cBusAlloc.alloc(n)}freeBus(e){return e.rate===Qa?this._.aBusAlloc.free(e):this._.cBusAlloc.free(e)}sendOSC(...e){this._.sendOSCAt?this.sendOSCAt(this.now(),...e):this.server.sendOSC(...e)}sendOSCAt(e,...n){this.server.sendOSCAt(e,...n)}beginSched(){this._.sendOSCAt=!0}endSched(){this._.sendOSCAt=!1}registerSDef(e){this._.sdefMap.set(e.name,e)}unregisterSDef(e){this._.sdefMap.delete(e.name)}getSDefByName(e){return this._.sdefMap.get(e)||null}registerNode(e){this._.nodeMap.set(e.nodeId,e)}unregisterNode(e){this._.nodeMap.delete(e.nodeId)}getNodeByNodeId(e){return this._.nodeMap.get(e)||null}apiEmit(e,n){this.emit('api-emit',{event:e,payload:n})}n_cmd(e){const n=this.getNodeByNodeId(e.args[0]);n&&'function'==typeof n[e.address]&&n[e.address](e)}['/n_go'](e){this.n_cmd(e)}['/n_end'](e){this.n_cmd(e)}['/n_off'](e){this.n_cmd(e)}['/n_on'](e){this.n_cmd(e)}['/n_move'](e){this.n_cmd(e)}['/n_info'](e){this.n_cmd(e)}}const Xr={};class Yr extends Se{constructor(e){super(),this.commands=e,this._syncId=0,this._syncFn=new Map,this._bqueryFn=new Map}allocBuffer(e,n,t,a){this._bqueryFn.set(e,a);const r=this.commands.b_query(e),s=this.commands.b_alloc(e,t,n,r);this.sendOSC(s)}loadBuffer(e,n,t){this._bqueryFn.set(e,t),this._loadBuffer(e,n)}sendOSC(e,n){'function'==typeof n&&(e=this._toSyncOSCMessage(e,n)),this._sendOSC(e)}sendOSCAt(e,n,t){this.sendOSC(Kn(e,n),t)}recvOSC(e){return Gn(e)?e.forEach((e)=>{this.recvOSC(e)}):void(e.args=e.args.map(({value:e})=>e),'function'==typeof this[e.address]&&this[e.address](e),this.emit('recvOSC',e))}_sendOSC(){throw new Error(`
      SubclassResponsibility: _sendOSC() should have been implemented by ${this.constructor.name}.
    `.trim())}_toSyncOSCMessage(e,n){const t=this._syncId++;return this._syncFn.set(t,n),zn(e,this.commands.sync(t))}['/synced']({args:e}){const n=e[0];this._syncFn.has(n)&&(this._syncFn.get(n)(),this._syncFn.delete(n))}['/b_info']({args:e}){const n=e.length/4;for(let t=0;t<n;t++){const n=e[4*t+0],a=e[4*t+1],r=e[4*t+2],s=e[4*t+3];this._bqueryFn.has(n)&&(this._bqueryFn.get(n)({bufId:n,length:a,numberOfChannels:r,sampleRate:s}),this._bqueryFn.delete(n))}}}var Zr=Object.freeze({notify:function(e){return{address:'/notify',args:[jn(e)]}},status:function(){return{address:'/status'}},dumpOSC:function(e){return{address:'/dumpOSC',args:[jn(e)]}},sync:function(e){return{address:'/sync',args:[jn(e)]}},clearSched:function(){return{address:'/clearSched'}},d_recv:function(e,n){return{address:'/d_recv',args:[Xn(e)].concat(null==n?[]:Xn(n))}},d_free:function(e,...n){return{address:'/d_free',args:[Wn(e)].concat(Yn(n,[Wn]))}},n_free:function(e,...n){return{address:'/n_free',args:[jn(e)].concat(Yn(n,[jn]))}},n_run:function(e,n,...t){return{address:'/n_run',args:[jn(e),jn(n)].concat(Yn(t,[jn,jn]))}},n_set:function(e,...n){return{address:'/n_set',args:[jn(e)].concat(n.map((e,n)=>{return 0==n%2?'string'==typeof e?Wn(e):jn(e):Array.isArray(e)&&1!==e.length?e.map(Vn):Vn(+e)}))}},n_map:function(e,...n){return{address:'/n_map',args:[jn(e)].concat(n.map((e,n)=>{return 0==n%2?'string'==typeof e?Wn(e):jn(e):jn(e)}))}},n_mapa:function(e,...n){return{address:'/n_mapa',args:[jn(e)].concat(n.map((e,n)=>{return 0==n%2?'string'==typeof e?Wn(e):jn(e):jn(e)}))}},n_before:function(e,n,...t){return{address:'/n_before',args:[jn(e),jn(n)].concat(Yn(t,[jn,jn]))}},n_after:function(e,n,...t){return{address:'/n_after',args:[jn(e),jn(n)].concat(Yn(t,[jn,jn]))}},s_new:function(e,n,t,a,...r){return{address:'/s_new',args:[Wn(e),jn(n),jn(t),jn(a)].concat(r.map((e,n)=>{return 0==n%2?'string'==typeof e?Wn(e):jn(e):Array.isArray(e)&&1!==e.length?e.map(Vn):e&&'string'==typeof e.type?e:'string'==typeof e?Wn(e):Vn(+e)}))}},s_get:function(e,...n){return{address:'/s_get',args:[jn(e)].concat(n.map((e)=>{return'string'==typeof e?Wn(e):jn(e)}))}},g_new:function(e,n,t,...a){return{address:'/g_new',args:[jn(e),jn(n),jn(t)].concat(Yn(a,[jn,jn,jn]))}},g_head:function(e,n,...t){return{address:'/g_head',args:[jn(e),jn(n)].concat(Yn(t,[jn,jn]))}},g_tail:function(e,n,...t){return{address:'/g_tail',args:[jn(e),jn(n)].concat(Yn(t,[jn,jn]))}},g_freeAll:function(e,...n){return{address:'/g_freeAll',args:[jn(e)].concat(Yn(n,[jn]))}},g_deepFree:function(e,...n){return{address:'/g_deepFree',args:[jn(e)].concat(Yn(n,[jn]))}},b_alloc:function(e,n,t,a){return{address:'/b_alloc',args:[jn(e),jn(n),jn(t)].concat(null==a?[]:Xn(a))}},b_allocRead:function(e,n,t,a,r){return{address:'/b_allocRead',args:[jn(e),Wn(n),jn(t),jn(a)].concat(null==r?[]:Xn(r))}},b_free:function(e,n){return{address:'/b_free',args:[jn(e)].concat(null==n?[]:Xn(n))}},b_zero:function(e,n){return{address:'/b_zero',args:[jn(e)].concat(null==n?[]:Xn(n))}},b_query:function(e,...n){return{address:'/b_query',args:[jn(e)].concat(Yn(n,[jn]))}},c_set:function(e,n,...t){return{address:'/c_set',args:[jn(e),Vn(n)].concat(Yn(t,[jn,Vn]))}},c_get:function(e,...n){return{address:'/c_get',args:[jn(e)].concat(Yn(n,[jn]))}}});class Qr extends Yr{constructor(e){super(Zr,e),this._worker=new Worker(e.workerPath),this._worker.onmessage=({data:e})=>{switch(e.type){case'osc':return this.recvOSC(e.payload);}}}_sendOSC(e){this._worker.postMessage({type:'osc',payload:e})}}var Jr=function(e){return function(n){const t=Un(n,e),a=$n(t);return t.on('api-emit',({event:e,payload:n})=>{a.emit(e,n)}),t._.timeline.start(),a}}(()=>{return Qr});e['default']=Jr,Object.defineProperty(e,'__esModule',{value:!0})});
